"use strict";(self.webpackChunkmyblog_frontend=self.webpackChunkmyblog_frontend||[]).push([[729],{7729:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var a=n(3433),s=n(9439),l=n(7313),r=n(8467),i=n(3403),c=n(4766),o=n(4165),m=n(5861),u=n(935),d=n(450),x=function(){var e=(0,m.Z)((0,o.Z)().mark((function e(t){var n,a,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,u.JU)(d.wO,"posts/".concat(t,"/comments"),t),e.prev=1,e.next=4,(0,u.QT)(n);case 4:return s=e.sent.data(),e.abrupt("return",null!==(a=null===s||void 0===s?void 0:s.comments)&&void 0!==a?a:[]);case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=(0,m.Z)((0,o.Z)().mark((function e(t,n){var a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,u.JU)(d.wO,"posts/".concat(t,"/comments"),t),e.prev=1,e.next=4,(0,u.pl)(a,{comments:n});case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),f=n(3931),h=n(8433),b=n(6233),j=n(973),N=n(6417),v=function(e){var t=e.title,n=e.text,a=e.target,r=e.submitCallback,i=e.closeCallback,c=(0,l.useState)(n),o=(0,s.Z)(c,2),m=o[0],u=o[1];return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)("form",{onSubmit:function(e){e.preventDefault(),a?r(m,a):r(m),u(n),i&&i()},className:"CommentEdit",children:[(0,N.jsx)("label",{className:"form-label text-555",children:t}),(0,N.jsx)("textarea",{value:m,onChange:function(e){var t=e.target.value;u(t)},className:"form-control mb-3 h-100px textarea-fixed",placeholder:"Write text","aria-label":"With textarea",maxLength:300}),(0,N.jsxs)("span",{className:"text-555",children:[m.length," / 300"]}),(0,N.jsx)("button",{type:"submit",className:"btn btn-outline-primary float-end",children:"Submit"}),i?(0,N.jsx)("button",{type:"button",className:"btn btn-outline-secondary me-2 float-end",onClick:i,children:"Cancel"}):null]})})},g=function(e){var t=e.reply,n=e.postAuthor,a=e.commentAuthor,r=e.onEditComment,c=e.onDeleteComment,o=(0,i.sJ)(j.F),m=(0,b.d)().openModal,u=(0,l.useState)(!1),d=(0,s.Z)(u,2),x=d[0],p=d[1],g=function(){p((function(e){return!e}))};return(0,N.jsxs)("div",{className:"ReplyBox bg-light",children:[(0,N.jsxs)("div",{className:"pt-3 ps-4",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("img",{src:"".concat(t.profileImage?t.profileImage:f),alt:"Profile",className:"w-50px h-50px-i img-thumbnail rounded-circle align-top me-2"}),(0,N.jsxs)("div",{className:"d-inline-block",children:[(0,N.jsx)("p",{className:"mb-0 fs-5 fw-semibold text-333",children:t.nickName}),(0,N.jsx)("p",{className:"fs-14px text-555",children:(0,h.Z)(t.createAt)})]}),!x&&o.uid&&t.createBy===o.uid?(0,N.jsx)(N.Fragment,{children:(0,N.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:g,children:"\xb7 Edit"})}):null,!x&&o.uid&&[t.createBy,n,a].includes(o.uid)?(0,N.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:function(){m("Warning","If you really want to delete this reply?",(function(){c(t.index)}),!0,"danger")},children:" \xb7 Delete "}):null]}),x?(0,N.jsx)("div",{className:"mb-4",children:(0,N.jsx)(v,{title:"Edit comment",text:t.detail,target:t.index,closeCallback:g,submitCallback:r})}):(0,N.jsx)("p",{className:"text-333 fs-5",children:t.detail})]}),(0,N.jsx)("hr",{className:"mb-0"})]})},C=function(e){var t=e.comment,n=e.reply,a=e.postAuthor,r=e.onNewReply,c=e.onEditComment,o=e.onDeleteComment,m=(0,i.sJ)(j.F),u=(0,b.d)().openModal,d=(0,l.useState)(!1),x=(0,s.Z)(d,2),p=x[0],C=x[1],k=function(){return C((function(e){return!e}))},y=(0,l.useState)(!1),w=(0,s.Z)(y,2),D=w[0],I=w[1],Z=function(){return I((function(e){return!e}))};return(0,N.jsxs)("div",{className:"CommentBox mt-3",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("img",{src:"".concat(t.profileImage?t.profileImage:f),alt:"Profile",className:"w-50px h-50px-i img-thumbnail rounded-circle align-top me-2"}),(0,N.jsxs)("div",{className:"d-inline-block",children:[(0,N.jsx)("p",{className:"mb-0 fs-5 fw-semibold text-333",children:t.nickName}),(0,N.jsx)("p",{className:"fs-14px text-555",children:(0,h.Z)(t.createAt)})]}),!D&&m.uid&&t.createBy===m.uid?(0,N.jsx)(N.Fragment,{children:(0,N.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:Z,children:" \xb7 Edit"})}):null,!D&&m.uid&&[t.createBy,a].includes(m.uid)?(0,N.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:function(){u("Warning","If you really want to delete this comment?",(function(){o(t.index)}),!0,"danger")},children:" \xb7 Delete "}):null]}),D?(0,N.jsx)("div",{className:"mt-3",children:(0,N.jsx)(v,{title:"Edit comment",text:t.detail,target:t.index,closeCallback:Z,submitCallback:c})}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("p",{className:"text-333 fs-5",children:t.detail}),p?null:(0,N.jsx)("span",{className:" text-777 pe-on",onClick:k,children:"Reply"})]}),(0,N.jsx)("hr",{className:"mb-0"}),n.map((function(e){return(0,N.jsx)(g,{reply:e,postAuthor:a,commentAuthor:t.createBy,onEditComment:c,onDeleteComment:o},e.index)})),p&&(0,N.jsxs)("div",{className:"mt-3",children:[(0,N.jsx)(v,{title:"New reply",text:"",target:t.index,closeCallback:k,submitCallback:r}),(0,N.jsx)("hr",{className:"mt-4"})]})]})},k=function(e){var t=e.postAuthor,n=(0,r.UO)(),o=(0,l.useState)([]),m=(0,s.Z)(o,2),u=m[0],d=m[1],f=(0,i.sJ)(j.F);(0,l.useEffect)((function(){n.docID&&x(n.docID).then((function(e){d(e)}))}),[n.docID]);var h=function(e,t){var s,l;if(f.uid&&e&&n.docID){var r={index:(0,c.k$)(),createAt:(new Date).getTime(),createBy:f.uid,nickName:null!==(s=f.nickname)&&void 0!==s?s:f.uid,profileImage:null!==(l=f.photoURL)&&void 0!==l?l:"",isNested:!!t,detail:e};t&&(r.nestedTarget=t);var i=[].concat((0,a.Z)(u),[r]);d(i),p(n.docID,i)}},b=function(e,t){if(f.uid&&e&&n.docID){for(var s=(0,a.Z)(u),l=-1,r=0;r<s.length;r++)if(s[r].index===t){l=r;break}-1!==l&&(s[l].detail=e,d(s),p(n.docID,s))}},g=function(e){if(f.uid&&n.docID){var t=u.filter((function(t){return t.index!==e&&(!t.nestedTarget||t.nestedTarget!==e)}));d(t),p(n.docID,t)}};return(0,N.jsxs)("section",{className:"CommentContainer",children:[(0,N.jsx)("h4",{className:"d-inline-flex",children:"Comments"}),(0,N.jsx)("span",{className:"text-primary",children:" (".concat(u.length,")")}),(0,N.jsx)("hr",{className:"mb-0"}),u.filter((function(e){return!e.isNested})).map((function(e){return(0,N.jsx)(C,{comment:e,reply:u.filter((function(t){return t.nestedTarget===e.index})),onNewReply:h,onEditComment:b,onDeleteComment:g,postAuthor:t},e.index)})),(0,N.jsxs)("div",{className:"my-4",children:[(0,N.jsx)(v,{title:"New comment",text:"",submitCallback:function(e){return h(e)}}),(0,N.jsx)("hr",{className:"mt-4"})]})]})}}}]);