"use strict";(self.webpackChunkmyblog_frontend=self.webpackChunkmyblog_frontend||[]).push([[729],{7729:function(e,t,n){n.r(t),n.d(t,{default:function(){return C}});var l=n(3433),a=n(9439),s=n(7313),i=n(8467),r=n(3403),c=n(4766),o=n(4165),m=n(5861),d=n(935),u=n(450),x=function(){var e=(0,m.Z)((0,o.Z)().mark((function e(t){var n,l,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,d.JU)(u.wO,"posts/".concat(t,"/comments"),t),e.prev=1,e.next=4,(0,d.QT)(n);case 4:return a=e.sent.data(),e.abrupt("return",null!==(l=null===a||void 0===a?void 0:a.comments)&&void 0!==l?l:[]);case 8:throw e.prev=8,e.t0=e.catch(1),console.log(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),f=n(3931),p=n(8433),h=n(6233),b=n(973),j=n(6417),N=function(e){var t=e.title,n=e.text,l=e.target,i=e.submitCallback,r=e.closeCallback,c=(0,s.useState)(n),o=(0,a.Z)(c,2),m=o[0],d=o[1];return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("form",{onSubmit:function(e){e.preventDefault(),l?i(m,l):i(m),d(n),r&&r()},className:"CommentEdit",children:[(0,j.jsx)("label",{className:"form-label text-555",children:t}),(0,j.jsx)("textarea",{value:m,onChange:function(e){var t=e.target.value;d(t)},className:"form-control mb-3 h-100px textarea-fixed",placeholder:"Write text","aria-label":"With textarea",maxLength:300}),(0,j.jsxs)("span",{className:"text-555",children:[m.length," / 300"]}),(0,j.jsx)("button",{type:"submit",className:"btn btn-outline-primary float-end",children:"Submit"}),r?(0,j.jsx)("button",{type:"button",className:"btn btn-outline-secondary me-2 float-end",onClick:r,children:"Cancel"}):null]})})},g=function(e){var t=e.reply,n=e.postAuthor,l=e.commentAuthor,i=e.onEditComment,c=e.onDeleteComment,o=(0,r.sJ)(b.F),m=(0,h.d)().openModal,d=(0,s.useState)(!1),u=(0,a.Z)(d,2),x=u[0],g=u[1],v=function(){g((function(e){return!e}))};return(0,j.jsxs)("div",{className:"ReplyBox bg-light",children:[(0,j.jsxs)("div",{className:"pt-3 ps-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("img",{src:"".concat(t.profileImage?t.profileImage:f),alt:"Profile",className:"w-50px h-50px-i img-thumbnail rounded-circle align-top me-2"}),(0,j.jsxs)("div",{className:"d-inline-block",children:[(0,j.jsx)("p",{className:"mb-0 fs-5 fw-semibold text-333",children:t.nickName}),(0,j.jsx)("p",{className:"fs-14px text-555",children:(0,p.Z)(t.createAt)})]}),!x&&o.uid&&t.createBy===o.uid?(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:v,children:"\xb7 Edit"})}):null,!x&&o.uid&&[t.createBy,n,l].includes(o.uid)?(0,j.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:function(){m("Warning","If you really want to delete this reply?",(function(){c(t.index)}),!0,"danger")},children:" \xb7 Delete "}):null]}),x?(0,j.jsx)("div",{className:"mb-4",children:(0,j.jsx)(N,{title:"Edit comment",text:t.detail,target:t.index,closeCallback:v,submitCallback:i})}):(0,j.jsx)("p",{className:"text-333 fs-5",children:t.detail})]}),(0,j.jsx)("hr",{className:"mb-0"})]})},v=function(e){var t=e.comment,n=e.reply,l=e.postAuthor,i=e.onNewReply,c=e.onEditComment,o=e.onDeleteComment,m=(0,r.sJ)(b.F),d=(0,h.d)().openModal,u=(0,s.useState)(!1),x=(0,a.Z)(u,2),v=x[0],C=x[1],y=function(){return C((function(e){return!e}))},k=(0,s.useState)(!1),w=(0,a.Z)(k,2),Z=w[0],D=w[1],A=function(){return D((function(e){return!e}))};return(0,j.jsxs)("div",{className:"CommentBox mt-3",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("img",{src:"".concat(t.profileImage?t.profileImage:f),alt:"Profile",className:"w-50px h-50px-i img-thumbnail rounded-circle align-top me-2"}),(0,j.jsxs)("div",{className:"d-inline-block",children:[(0,j.jsx)("p",{className:"mb-0 fs-5 fw-semibold text-333",children:t.nickName}),(0,j.jsx)("p",{className:"fs-14px text-555",children:(0,p.Z)(t.createAt)})]}),!Z&&m.uid&&t.createBy===m.uid?(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:A,children:" \xb7 Edit"})}):null,!Z&&m.uid&&[t.createBy,l].includes(m.uid)?(0,j.jsx)("span",{className:"fs-14px text-777 pe-on",role:"button",onClick:function(){d("Warning","If you really want to delete this comment?",(function(){o(t.index)}),!0,"danger")},children:" \xb7 Delete "}):null]}),Z?(0,j.jsx)("div",{className:"mt-3",children:(0,j.jsx)(N,{title:"Edit comment",text:t.detail,target:t.index,closeCallback:A,submitCallback:c})}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("p",{className:"text-333 fs-5",children:t.detail}),v?null:(0,j.jsx)("span",{className:" text-777 pe-on",onClick:y,children:"Reply"})]}),(0,j.jsx)("hr",{className:"mb-0"}),n.map((function(e){return(0,j.jsx)(g,{reply:e,postAuthor:l,commentAuthor:t.createBy,onEditComment:c,onDeleteComment:o},e.index)})),v&&(0,j.jsxs)("div",{className:"mt-3",children:[(0,j.jsx)(N,{title:"New reply",text:"",target:t.index,closeCallback:y,submitCallback:i}),(0,j.jsx)("hr",{className:"mt-4"})]})]})},C=function(e){var t=e.postAuthor,n=(0,i.UO)(),o=(0,s.useState)([]),m=(0,a.Z)(o,2),d=m[0],u=m[1],f=(0,r.sJ)(b.F);(0,s.useEffect)((function(){n.docID&&x(n.docID).then((function(e){u(e)}))}),[n.docID]);var p=function(e,t){var n,a;if(f.uid&&e){var s={index:(0,c.k$)(),createAt:(new Date).getTime(),createBy:f.uid,nickName:null!==(n=f.nickname)&&void 0!==n?n:f.uid,profileImage:null!==(a=f.photoURL)&&void 0!==a?a:"",isNested:!!t,nestedTarget:null!==t&&void 0!==t?t:void 0,detail:e};u((function(e){return[].concat((0,l.Z)(e),[s])}))}},h=function(e,t){console.log(e),console.log(t);for(var n=(0,l.Z)(d),a=-1,s=0;s<n.length;s++)if(n[s].index===t){a=s;break}-1!==a&&(n[a].detail=e,u(n))},g=function(e){var t=d.filter((function(t){return t.index!==e&&(!t.nestedTarget||t.nestedTarget!==e)}));u(t)};return(0,j.jsxs)("section",{className:"CommentContainer",children:[(0,j.jsx)("h4",{className:"d-inline-flex",children:"Comments"}),(0,j.jsx)("span",{className:"text-primary",children:" (".concat(d.length,")")}),(0,j.jsx)("hr",{className:"mb-0"}),d.filter((function(e){return!e.isNested})).map((function(e){return(0,j.jsx)(v,{comment:e,reply:d.filter((function(t){return t.nestedTarget===e.index})),onNewReply:p,onEditComment:h,onDeleteComment:g,postAuthor:t},e.index)})),(0,j.jsxs)("div",{className:"my-4",children:[(0,j.jsx)(N,{title:"New comment",text:"",submitCallback:function(e){return p(e)}}),(0,j.jsx)("hr",{className:"mt-4"})]})]})}}}]);