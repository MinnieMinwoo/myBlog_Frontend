"use strict";(self.webpackChunkmyblog_frontend=self.webpackChunkmyblog_frontend||[]).push([[107],{949:function(n,e,t){t.r(e),t.d(e,{default:function(){return on}});var i,a,r,o,s,c,l,u,d,f,p=t(4165),h=t(5861),g=t(1413),m=t(9439),v=t(7313),x=t(8467),Z=t(78),b=t(2495),j=t(973),k=t(6233),y=t(334),w=t(9235),C=t(2552),P=t(3433),D=t(168),L=t(4766),S=t(3858),N=t(1616),E=t(6469),I=t(2102),z=t(3298),W=t(244),F=t(1921),T=t(7657),M=t(4427),U=t(6417),V=W.ZP.div(i||(i=(0,D.Z)(["\n  &.Drag {\n    opacity: 0.3;\n  }\n"]))),O=(0,W.ZP)(N.Z)(a||(a=(0,D.Z)(["\n  margin-top: 20px;\n  animation-name: init;\n  animation-duration: 1s;\n  animation-duration: linear;\n  @keyframes init {\n    0% {\n      opacity: 0;\n    }\n    100% {\n      opacity: 1;\n    }\n  }\n  input {\n    width: 100%;\n    color: #777;\n    border: 0;\n    border-bottom: 1px solid #eee;\n    &:focus {\n      outline: none;\n      border-bottom: 2px solid #777;\n    }\n    font-size: 36px;\n    margin-bottom: 20px;\n  }\n  button {\n    margin: 0;\n    margin-top: 20px;\n  }\n"]))),B=W.ZP.img(r||(r=(0,D.Z)(["\n  width: 40px;\n  height: 40px;\n  margin-right: 20px;\n  cursor: pointer;\n"]))),_=(0,W.ZP)(S.ZP)(o||(o=(0,D.Z)(["\n  height: calc(100vh - 260px) !important;\n"]))),H=function(n){var e=n.isEdit,t=n.postContent,i=n.setPostContent,a=n.onPreview,r=(0,Z.sJ)(j.F),o=(0,v.useState)(!1),s=(0,m.Z)(o,2),c=s[0],l=s[1],u=(0,v.useRef)(null),d=(0,v.useRef)(null),f=(0,k.d)().openModal,b=(0,F.p)().openToast,y=(0,x.s0)(),w=function(){var n=(0,h.Z)((0,p.Z)().mark((function n(e){var t;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),e.stopPropagation(),null!==(t=e.dataTransfer.files[0])&&void 0!==t&&t.type.includes("image/")){n.next=6;break}return l(!1),n.abrupt("return");case 6:D(t);case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),C={name:"image",keyCommand:"image",buttonProps:{"aria-label":"Insert image"},icon:(0,U.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 520 520",children:(0,U.jsx)("path",{fill:"currentColor",d:"M5,350h340V0H5V350z M25,330v-62.212h300V330H25z M179.509,247.494H60.491L120,171.253L179.509,247.494z M176.443,211.061l33.683-32.323l74.654,69.05h-79.67L176.443,211.061z M325,96.574c-6.384,2.269-13.085,3.426-20,3.426 c-33.084,0-60-26.916-60-60c0-6.911,1.156-13.612,3.422-20H325V96.574z M25,20h202.516C225.845,26.479,225,33.166,225,40 c0,44.112,35.888,80,80,80c6.837,0,13.523-0.846,20-2.518v130.306h-10.767l-104.359-96.526l-45.801,43.951L120,138.748 l-85.109,109.04H25V20z"})}),execute:function(){var n=(0,h.Z)((0,p.Z)().mark((function n(){var e;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:null===(e=d.current)||void 0===e||e.click();case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()},D=function(){var n=(0,h.Z)((0,p.Z)().mark((function n(e){var a,o,s,c,f;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=null===(a=u.current)||void 0===a?void 0:a.querySelector("textarea")){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,(0,T.T)(e,"$image/".concat(r.uid,"/").concat((0,L.k$)()));case 6:s=n.sent,c=t.postData,f=o.selectionStart,i((function(n){return(0,g.Z)((0,g.Z)({},n),{},{postData:"".concat(c.slice(0,f),"![](").concat(s,")").concat(c.slice(f)),imageList:[].concat((0,P.Z)(n.imageList),[s])})})),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(3),console.log(n.t0),b("Error","Image upload failed.","danger");case 16:return n.prev=16,d.current&&(d.current.value=""),l(!1),n.finish(16);case 20:case"end":return n.stop()}}),n,null,[[3,12,16,20]])})));return function(e){return n.apply(this,arguments)}}();return(0,U.jsxs)(V,{className:c?"OnWrite Drag":"OnWrite",children:[(0,U.jsx)("header",{children:(0,U.jsx)(E.Z,{bg:"light",children:(0,U.jsx)(I.Z,{children:(0,U.jsxs)(E.Z.Brand,{children:[(0,U.jsx)(B,{src:M,alt:"blog logo",onClick:function(){f("Warning","Post data will not be saved when you leave the window.",(function(){y("/")}),!0)}}),e?"Edit post":"Write your Story"]})})})}),(0,U.jsx)(O,{sm:{span:10,offset:1},lg:{span:8,offset:2},xxl:{span:6,offset:3},className:"OnWrite",children:(0,U.jsxs)("section",{onDragEnter:function(n){n.preventDefault(),n.stopPropagation(),l(!0)},onDragLeave:function(n){n.preventDefault(),n.stopPropagation(),l(!1)},onDragOver:function(n){n.preventDefault(),n.stopPropagation(),n.dataTransfer.files&&l(!0)},onDrop:w,children:[(0,U.jsx)("input",{hidden:!0,type:"file",accept:"image/*",ref:d,defaultValue:"",onChange:function(){var n;(null===(n=d.current)||void 0===n?void 0:n.files)&&D(d.current.files[0])}}),(0,U.jsx)("input",{placeholder:"Write post title",value:t.title,onChange:function(n){var e=n.target.value;i((function(n){return(0,g.Z)((0,g.Z)({},n),{},{title:e})}))},maxLength:50,required:!0}),(0,U.jsx)("div",{ref:u,children:(0,U.jsx)(_,{"data-color-mode":"light",value:t.postData,commands:[S.CN.TN,S.CN.Se,S.CN.pU,S.CN.Jq,S.CN.mW,S.CN.p4,C,S.CN.TU,S.CN.Gr],onChange:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";i((function(e){return(0,g.Z)((0,g.Z)({},e),{},{postData:n})}))}})}),(0,U.jsx)(z.Z,{variant:"secondary",children:"Quit"}),(0,U.jsx)(z.Z,{className:"float-end",onClick:a,children:e?"Edit":"Write up"})]})})]})},$=t(8648),J=t(7881),R=t(8043),q=t(1366),A=t(3931),Y=t(4646),G=W.ZP.div(s||(s=(0,D.Z)(["\n  display: flex;\n  position: absolute;\n  visibility: hidden;\n  background-color: #fff;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n\n  &.open {\n    visibility: visible;\n    animation-name: open;\n    animation-duration: 0.5s;\n    animation-duration: linear;\n    @keyframes open {\n      0% {\n        height: 0%;\n      }\n      100% {\n        height: 100%;\n      }\n    }\n  }\n\n  &.close {\n    visibility: hidden;\n    animation-name: close;\n    animation-duration: 0.5s;\n    animation-duration: linear;\n    @keyframes close {\n      0% {\n        height: 100%;\n        visibility: visible;\n      }\n      99.9% {\n        height: 0.1%;\n        visibility: visible;\n      }\n      100% {\n        height: 0%;\n        visibility: hidden;\n      }\n    }\n  }\n"]))),Q=(0,W.ZP)(N.Z)(c||(c=(0,D.Z)(["\n  padding: 0 30px;\n  border-right: 1px solid #eee;\n  align-self: center;\n"]))),K=(0,W.ZP)(N.Z)(l||(l=(0,D.Z)(["\n  padding: 0 30px;\n  align-self: center;\n"]))),X=(0,W.ZP)($.Z)(u||(u=(0,D.Z)(["\n  float: right;\n"]))),nn=(0,W.ZP)(J.Z)(d||(d=(0,D.Z)(["\n  background-color: #eee;\n  width: 100%;\n  aspect-ratio: 16 / 9;\n  object-fit: cover;\n  object-position: center center;\n"]))),en=(0,W.ZP)(R.Z)(f||(f=(0,D.Z)(["\n  height: 200px;\n"]))),tn=function(n){var e=n.isEdit,t=n.isPreview,i=n.postContent,a=n.setPostContent,r=n.onPreview,o=n.onSubmit,s=(0,v.useRef)(null),c=(0,Z.sJ)(j.F),l=(0,v.useState)([]),u=(0,m.Z)(l,2),d=u[0],f=u[1],x=(0,v.useState)(""),b=(0,m.Z)(x,2),k=b[0],y=b[1],w=(0,v.useState)(!1),C=(0,m.Z)(w,2),P=C[0],D=C[1],S=(0,F.p)().openToast;(0,v.useEffect)((function(){c.uid&&(0,Y.AT)(c.uid).then((function(n){if(f(n),i.category.length){var e=i.category,t=n.map((function(n){return n.mainField})).indexOf(e[0]),a=n[t].subField.indexOf(e[1]);y(String([t,a]))}}))}),[c,i.category]),(0,v.useEffect)((function(){t&&D(!0)}),[t]);var N=function(){var n=(0,h.Z)((0,p.Z)().mark((function n(e){var t,i;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.target.files){n.next=3;break}throw console.log("no image files");case 3:return n.prev=3,n.next=6,(0,T.T)(t[0],"$thumbnail/".concat((0,L.k$)()));case 6:i=n.sent,a((function(n){return(0,g.Z)((0,g.Z)({},n),{},{thumbnailImgLink:i})})),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(3),console.log(n.t0),S("Error","Image upload failed.","danger");case 14:case"end":return n.stop()}}),n,null,[[3,10]])})));return function(e){return n.apply(this,arguments)}}();return(0,U.jsxs)(G,{className:"Preview ".concat(t?"open":P?"close":""),children:[(0,U.jsx)(Q,{md:{span:5,offset:1},xxl:{span:4,offset:2},children:(0,U.jsxs)($.Z,{gap:3,children:[(0,U.jsx)("h3",{children:"Preview"}),(0,U.jsx)(nn,{src:i.thumbnailImgLink?i.thumbnailImgLink:A,alt:"Thumbnail",thumbnail:!0}),(0,U.jsx)("input",{hidden:!0,type:"file",accept:"image/*",ref:s,src:i.thumbnailImgLink,onChange:N}),(0,U.jsxs)($.Z,{gap:2,direction:"horizontal",children:[(0,U.jsx)(z.Z,{onClick:function(){var n;null===(n=s.current)||void 0===n||n.click()},children:"Upload Image"}),(0,U.jsx)(z.Z,{variant:"outline-primary",onClick:function(){var n;i.thumbnailImgLink&&(0,T.j)(i.thumbnailImgLink),a((function(n){return(0,g.Z)((0,g.Z)({},n),{},{thumbnailImgLink:""})})),null!==(n=s.current)&&void 0!==n&&n.value&&(s.current.value="")},hidden:!i.thumbnailImgLink,children:"Delete Image"})]}),(0,U.jsx)("h3",{children:i.title}),(0,U.jsx)(en,{size:"lg",children:(0,U.jsx)(q.Z.Control,{as:"textarea",value:i.thumbnailData,maxLength:150,onChange:function(n){var e=n.target.value;a((function(n){return(0,g.Z)((0,g.Z)({},n),{},{thumbnailData:e})}))}})}),(0,U.jsxs)("p",{children:[i.thumbnailData.length,"/150"]})]})}),(0,U.jsxs)(K,{xs:0,md:5,xxl:4,children:[(0,U.jsxs)($.Z,{gap:1,children:[(0,U.jsx)("h4",{children:"Category Setting"}),(0,U.jsxs)(q.Z.Select,{value:k,onChange:function(n){var e=n.target.value;if(y(e),""!==e){var t=e.split(",").map(Number);a((function(n){var e;return(0,g.Z)((0,g.Z)({},n),{},{category:null!==(e=[d[t[0]].mainField,d[t[0]].subField[t[1]]])&&void 0!==e?e:[]})}))}else a((function(n){return(0,g.Z)((0,g.Z)({},n),{},{category:[]})}))},children:[(0,U.jsx)("option",{value:"",children:"None"}),d&&d.map((function(n,e){return n.subField.map((function(t,i){return(0,U.jsx)("option",{value:String([[e,i]]),children:"".concat(n.mainField," - ").concat(t)},i)}))}))]})]}),(0,U.jsxs)(X,{gap:3,direction:"horizontal",children:[(0,U.jsx)(z.Z,{variant:"outline-primary",onClick:r,children:"Cancel"}),(0,U.jsx)(z.Z,{onClick:o,children:e?"Edit":"Write Up"})]})]})]})},an=t(2691),rn=t(3167),on=function(){var n=(0,Z.FV)(b.B),e=(0,m.Z)(n,2),t=e[0],i=e[1],a=(0,Z.sJ)(j.F),r=(0,v.useState)({title:"",category:[],postData:"**Write your post**",thumbnailImgLink:"",thumbnailData:"",imageList:[]}),o=(0,m.Z)(r,2),s=o[0],c=o[1],l=(0,v.useState)(!1),u=(0,m.Z)(l,2),d=u[0],f=u[1],P=(0,k.d)().openModal,D=(0,x.s0)(),L=(0,x.UO)();!function(){var n=function(n){n.preventDefault(),n.returnValue=""};(0,v.useEffect)((function(){return window.addEventListener("beforeunload",n),function(){window.removeEventListener("beforeunload",n)}}),[])}(),(0,v.useEffect)((function(){L["*"]&&(i(!0),(0,w.AU)(L["*"]).then((function(n){var e,t=(0,y.v0)();if(n.createdBy!==(null===(e=t.currentUser)||void 0===e?void 0:e.uid)){throw{name:"Permission Denied",code:"No_Permission"}}c((function(e){var t;return(0,g.Z)((0,g.Z)({},e),{},{title:n.title,category:null!==(t=n.category)&&void 0!==t?t:[],postData:n.detail,thumbnailImgLink:n.thumbnailImageURL,thumbnailData:n.thumbnailData,imageList:n.imageList})}))})).catch((function(n){console.log(n);var e;switch(null===n||void 0===n?void 0:n.code){case"No_PostData":e="You entered wrong url link";break;case"No_Permission":e="You don't have permission on this post.";break;default:e="Something wrong, try again later."}P("Post Loading failed",e,(function(){D("/")}))})).finally((function(){return i(!1)})))}),[]);var S=function(){var n=(0,h.Z)((0,p.Z)().mark((function n(){var e;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!L["*"]){n.next=7;break}return n.next=4,(0,w.CP)(L["*"],s);case 4:e=L["*"],n.next=10;break;case 7:return n.next=9,(0,w.Cd)(s,a);case 9:e=n.sent;case 10:D("/home/".concat(a.nickname,"/").concat(e)),n.next=19;break;case 13:n.prev=13,n.t0=n.catch(0),console.log(n.t0),"Post Submit failed","Something wrong, try again later.",P("Post Submit failed","Something wrong, try again later.");case 19:case"end":return n.stop()}}),n,null,[[0,13]])})));return function(){return n.apply(this,arguments)}}(),N=function(){var n=/[`\n|\r|~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gim;!s.thumbnailData&&c((function(e){return(0,g.Z)((0,g.Z)({},e),{},{thumbnailData:s.postData.replace(n,"").substring(0,150)})})),f((function(n){return!n}))};return(0,U.jsxs)("div",{className:"Write",children:[t?(0,U.jsx)(an.Z,{}):null,(0,U.jsx)(C.Z,{}),(0,U.jsx)(rn.Z,{}),(0,U.jsx)(tn,{isEdit:Boolean(L["*"]),isPreview:d,postContent:s,setPostContent:c,onPreview:N,onSubmit:S}),(0,U.jsx)(H,{isEdit:Boolean(L["*"]),postContent:s,setPostContent:c,onPreview:N})]})}},4427:function(n,e,t){n.exports=t.p+"static/media/logo.006bdc187418d22db610.png"}}]);