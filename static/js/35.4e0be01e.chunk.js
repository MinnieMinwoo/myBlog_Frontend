"use strict";(self.webpackChunkmyblog_frontend=self.webpackChunkmyblog_frontend||[]).push([[35],{9035:function(e,r,t){t.r(r),t.d(r,{default:function(){return N}});var n=t(4165),a=t(3433),i=t(7762),c=t(5861),s=t(9439),u=t(7313),o=t(8467),l=t(3403),d=t(973),b=t(6233),m=t(1921),f=t(2250),g=t(4646),p=t(1413),x=t(2135),h=t(3931),v=t(6417),y=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,v.jsxs)("form",{children:[(0,v.jsx)("label",{className:"form-label",children:"Write down the category name."}),(0,v.jsx)("input",{className:"form-control",type:"text",placeholder:"enter category name",defaultValue:r,ref:e,required:!0})]})},k=t(7657),C=function(e){var r=e.isEdit,t=e.imgLink,s=e.mainID,o=e.subID,f=e.categoryData,C=e.setCategoryData,j=(0,l.sJ)(d.F),N=(0,u.useRef)(null),F=(0,u.useRef)(null),w=(0,u.useRef)(null),Z=(0,u.useRef)(""),E=(0,b.d)().openModal,D=(0,m.p)().openToast,S=function(){var e=(0,c.Z)((0,n.Z)().mark((function e(r){var t,c,s,u,o,l,d,b,m,x=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=x.length>1&&void 0!==x[1]?x[1]:-1,u=x.length>2&&void 0!==x[2]?x[2]:-1,o=null!==(t=null===(c=N.current)||void 0===c?void 0:c.value)&&void 0!==t?t:"",l=j.uid,d=(0,a.Z)(f),l&&-1!==s){e.next=7;break}return e.abrupt("return",D("Error","Using corrupt data.","danger"));case 7:if(!r.includes("edit")||!r.includes("Sub")){e.next=27;break}if(o){e.next=10;break}return e.abrupt("return",D("Error","Using corrupt data.","danger"));case 10:b=(0,i.Z)(f),e.prev=11,b.s();case 13:if((m=b.n()).done){e.next=19;break}if(!m.value.subField.includes(o)){e.next=17;break}return e.abrupt("return",D("Error","You entered duplicated category name.","warning"));case 17:e.next=13;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(11),b.e(e.t0);case 24:return e.prev=24,b.f(),e.finish(24);case 27:e.prev=27,e.t1=r,e.next="editSubCategory"===e.t1?31:"editCategoryImage"===e.t1?36:"deleteSubCategory"===e.t1?42:47;break;case 31:return e.next=33,(0,g.SV)(f[s],f[s].subField[u],o,l);case 33:return d[s].subField=d[s].subField.map((function(e){return e===f[s].subField[u]?o:e})),C(d),e.abrupt("break",48);case 36:return console.log(Z),d[s].thumbnailLink[u]=Z.current,e.next=40,(0,g.yR)(d[s].thumbnailLink,d[s].mainField,l);case 40:return C(d),e.abrupt("break",48);case 42:return e.next=44,(0,g.c2)(f[s],f[s].subField[u],l);case 44:return d[s]=(0,p.Z)((0,p.Z)({},d[s]),{},{subField:d[s].subField.filter((function(e,r){return r!==u})),thumbnailLink:d[s].thumbnailLink.filter((function(e,r){return r!==u}))}),C(d),e.abrupt("break",48);case 47:return e.abrupt("return");case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(27),console.log(e.t2),D("Error","Category edit failed.","danger");case 54:case"end":return e.stop()}}),e,null,[[11,21,24,27],[27,50]])})));return function(r){return e.apply(this,arguments)}}(),I=function(e){var r,a,i=e.target,s=null!==(r=i.id.split(",").map((function(e){return Number(e)})))&&void 0!==r?r:[],u="",o=!1,l=function(){};switch(i.name){case"editSubCategory":u="Edit sub category",a=y(N,f[s[0]].subField[s[1]]),l=function(){S("editSubCategory",s[0],s[1])};break;case"deleteSubCategory":u="Warning",a="If you really want to delete this sub category?",l=function(){S("deleteSubCategory",s[0],s[1])},o=!0;break;case"editCategoryImage":Z.current=t;var d=function(){var e=(0,c.Z)((0,n.Z)().mark((function e(r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.target.files){e.next=2;break}return e.abrupt("return");case 2:return Z.current&&(0,k.j)(Z.current),e.next=5,(0,g.sk)(r.target.files[0]);case 5:Z.current=e.sent,w.current&&(w.current.src=Z.current);case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();u="Thumbnail edit",a=function(e,r,t,n,a){var i,c;return(0,v.jsxs)("form",{children:[(0,v.jsx)("label",{className:"form-label",children:"Please upload the image."}),(0,v.jsxs)("div",{className:"vstack gap-2",children:[(0,v.jsx)("div",{className:"w-100 ratio ratio-16x9",children:(0,v.jsx)("img",{className:"img img-fluid object-fit-cover border rounded fs-0",ref:t,src:null!==(i=t.current)&&void 0!==i&&i.src?null===(c=t.current)||void 0===c?void 0:c.src:e.current?e.current:h,alt:"Thumbnail"})}),(0,v.jsx)("input",{hidden:!0,type:"file",accept:"image/*",ref:r,onChange:n}),(0,v.jsxs)("div",{className:"hstack gap-2",children:[(0,v.jsx)("button",{className:"btn btn-primary",onClick:function(){var e;null===(e=r.current)||void 0===e||e.click()},children:"Upload Image"}),(0,v.jsx)("button",{className:"btn btn-outline-primary",onClick:a,children:"Delete Image"})]})]})]})}(Z,F,w,d,(function(){Z.current&&(0,k.j)(Z.current),Z.current="",w.current&&(w.current.src=h)})),l=function(){S("editCategoryImage",s[0],s[1])};break;default:return}E(u,a,l,!0,o?"danger":"primary")};return(0,v.jsx)("div",{className:"PostCategoryCard p-2 col col-12 col-md-6 col-xl-4",children:(0,v.jsxs)("div",{className:"card",children:[(0,v.jsx)(x.rU,{className:"ratio ratio-16x9",to:"".concat(f[s].mainField,"/").concat(f[s].subField[o]),children:(0,v.jsx)("img",{className:"card-img-top img-fluid object-fit-cover",src:t,onError:function(e){e.currentTarget.src=h},alt:"Thumbnail"})}),(0,v.jsxs)("div",{className:"card-body",children:[(0,v.jsx)(x.rU,{className:"card-title fs-5 fw-semibold text-decoration-none text-111",to:"".concat(f[s].mainField,"/").concat(f[s].subField[o]),children:"".concat(f[s].subField[o])}),(0,v.jsxs)("div",{className:"hstack",hidden:!r,children:[(0,v.jsx)("button",{id:"".concat(s,",").concat(o,",1"),className:"btn btn-outline-secondary",name:"editSubCategory",onClick:I,children:"\u270e"}),(0,v.jsx)("button",{id:"".concat(s,",").concat(o,",2"),className:"btn btn-outline-info ms-auto",name:"editCategoryImage",onClick:I,children:"\ud83d\uddbc\ufe0f"}),(0,v.jsx)("button",{id:"".concat(s,",").concat(o,",3"),className:"btn btn-outline-danger ms-auto",name:"deleteSubCategory",onClick:I,children:"\ud83d\uddd1\ufe0f"})]})]})]},o)})},j=function(e){var r=e.isEdit,t=e.categoryData,s=e.setCategoryData,o=(0,l.sJ)(d.F),f=(0,u.useRef)(null),x=(0,b.d)().openModal,h=(0,m.p)().openToast,k=function(){var e=(0,c.Z)((0,n.Z)().mark((function e(r){var c,u,l,d,b,m,x,v,y,k=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=k.length>1&&void 0!==k[1]?k[1]:-1,d=null!==(c=null===(u=f.current)||void 0===u?void 0:u.value)&&void 0!==c?c:"",b=o.uid,m=(0,a.Z)(t),b){e.next=6;break}return e.abrupt("return",h("Error","Using corrupt data.","danger"));case 6:if(!r.includes("add")&&!r.includes("delete")||-1!==l){e.next=8;break}return e.abrupt("return",h("Error","Using corrupt data.","danger"));case 8:if(!r.includes("add")&&!r.includes("edit")){e.next=28;break}if(d){e.next=11;break}return e.abrupt("return",h("Error","Using corrupt data.","danger"));case 11:x=(0,i.Z)(t),e.prev=12,x.s();case 14:if((v=x.n()).done){e.next=20;break}if(y=v.value,!(r.includes("Main")&&y.mainField===d||y.subField.includes(d))){e.next=18;break}return e.abrupt("return",h("Error","You entered duplicated category name.","warning"));case 18:e.next=14;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(12),x.e(e.t0);case 25:return e.prev=25,x.f(),e.finish(25);case 28:e.prev=28,e.t1=r,e.next="addSubCategory"===e.t1?32:"editMainCategory"===e.t1?38:"deleteMainCategory"===e.t1?43:47;break;case 32:return e.next=34,(0,g.mR)(t[l],d,b);case 34:return m[l].subField.push(d),m[l].thumbnailLink.push(""),s(m),e.abrupt("break",48);case 38:return e.next=40,(0,g.FH)(t.map((function(e,r){return r===l?d:e.mainField})),t[l],d,b);case 40:return m[l]=(0,p.Z)((0,p.Z)({},m[l]),{},{mainField:d}),s(m),e.abrupt("break",48);case 43:return e.next=45,(0,g.YO)(t[l].mainField,b);case 45:return s((function(e){return e.filter((function(e){return e.mainField!==t[l].mainField}))})),e.abrupt("break",48);case 47:return e.abrupt("return");case 48:e.next=54;break;case 50:e.prev=50,e.t2=e.catch(28),console.log(e.t2),h("Error","Category edit failed.","danger");case 54:case"end":return e.stop()}}),e,null,[[12,22,25,28],[28,50]])})));return function(r){return e.apply(this,arguments)}}(),j=function(e){var r,n,a=e.target,i=null!==(r=a.id.split(",").map((function(e){return Number(e)})))&&void 0!==r?r:[],c="",s=function(){};switch(a.name){case"addSubCategory":c="Add sub category",n=y(f),s=function(){k("addSubCategory",i[0])};break;case"editMainCategory":c="Edit category",n=y(f,t[i[0]].mainField),s=function(){k("editMainCategory",i[0])};break;case"deleteMainCategory":c="Warning",n="If you really want to delete this category?",s=function(){k("deleteMainCategory",i[0])};break;default:return}x(c,n,s,!0,"primary")};return(0,v.jsx)("div",{className:"PostCategorySection col",children:t.map((function(e,n){return(0,v.jsxs)("section",{className:"pt-3 pb-4 bt-light",children:[(0,v.jsxs)("div",{className:"hstack gap-1 mb-1",children:[(0,v.jsx)("h3",{className:"fw-semibold d-inline-block text-333",children:e.mainField}),(0,v.jsxs)("span",{className:"text-secondary fs-5",children:["(",e.subField.length,")"]}),r?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("button",{className:"btn btn-outline-primary w-100px ms-auto",id:"".concat(n,",1"),name:"addSubCategory",onClick:j,children:"Add"}),(0,v.jsx)("button",{className:"btn btn-outline-secondary w-100px ",id:"".concat(n,",2"),name:"editMainCategory",onClick:j,children:"Edit"}),(0,v.jsx)("button",{className:"btn btn-danger w-100px ",id:"".concat(n,",3"),name:"deleteMainCategory",onClick:j,children:"Delete"})]}):null]}),(0,v.jsx)("div",{className:"container p-0 d-flex flex-wrap w-100",children:e.subField.map((function(a,i){return(0,v.jsx)(C,{isEdit:r,imgLink:e.thumbnailLink[i],mainID:n,subID:i,categoryData:t,setCategoryData:s},i)}))})]},n)}))})},N=function(){var e=(0,l.sJ)(d.F),r=(0,u.useState)(!1),t=(0,s.Z)(r,2),p=t[0],x=t[1],h=(0,o.bx)(),k=(0,s.Z)(h,2),C=k[0],N=k[1],F=(0,u.useRef)(null),w=(0,o.UO)(),Z=(0,b.d)().openModal,E=(0,m.p)().openToast;(0,u.useEffect)((function(){if(!w.userID)throw console.log("no params");(0,f.d3)(w.userID).then((function(e){(0,g.AT)(e).then((function(e){return N(e)}))})).catch((function(){E("Warning","Category loading failed","warning")}))}),[]);var D=function(){var r=(0,c.Z)((0,n.Z)().mark((function r(){var t,c,s,u,o,l;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null!==(t=null===(c=F.current)||void 0===c?void 0:c.value)&&void 0!==t?t:"",(u=e.uid)&&s){r.next=4;break}return r.abrupt("return",E("Error","Using corrupt data.","danger"));case 4:o=(0,i.Z)(C),r.prev=5,o.s();case 7:if((l=o.n()).done){r.next=13;break}if(l.value.mainField!==s){r.next=11;break}return r.abrupt("return",E("Error","You entered duplicated category name.","warning"));case 11:r.next=7;break;case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(5),o.e(r.t0);case 18:return r.prev=18,o.f(),r.finish(18);case 21:return r.prev=21,r.next=24,(0,g.Ok)(s,u);case 24:N((function(e){return[].concat((0,a.Z)(e),[{mainField:s,subField:[],thumbnailLink:[]}])})),r.next=31;break;case 27:r.prev=27,r.t1=r.catch(21),console.log(r.t1),E("Error","Category add failed.","danger");case 31:case"end":return r.stop()}}),r,null,[[5,15,18,21],[21,27]])})));return function(){return r.apply(this,arguments)}}();return(0,v.jsxs)("div",{className:"PostCategoryList my-4 mx-md-4 px-md-4",children:[(0,v.jsx)("div",{className:"mb-3",children:(0,v.jsxs)("div",{className:"hstack gap-1",children:[(0,v.jsx)("h2",{className:"fw-bold d-inline-block",children:"Categories"}),(0,v.jsxs)("span",{className:"text-primary fs-5",children:["(",C.length,")"]}),p?(0,v.jsx)("button",{className:"btn btn-outline-primary ms-auto w-100px",name:"addMainCategory",onClick:function(){var e=y(F);Z("Add category",e,(function(){D()}),!0)},children:"Add"}):null,(0,v.jsx)("button",{className:"btn btn-primary ".concat(p?null:"ms-auto"),onClick:function(){x((function(e){return!e}))},children:p?"Complete":"Edit"})]})}),(0,v.jsx)(j,{isEdit:p,categoryData:C,setCategoryData:N})]})}}}]);